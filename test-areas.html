<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест тренажёра площадей</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .container {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        #output {
            margin-top: 20px;
            white-space: pre-wrap;
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Тест генератора площадей</h1>

    <div class="container">
        <button onclick="testGenerator()">Тест генератора</button>
        <button onclick="testDrawing()">Тест отрисовки</button>
        <button onclick="testTrainer()">Тест тренажёра</button>
        <div id="output"></div>
    </div>

    <div class="container">
        <h3>Визуализация:</h3>
        <div id="visualization"></div>
    </div>

    <!-- Подключаем необходимые скрипты -->
    <script src="src/utils/progress.js"></script>
    <script src="src/utils/ShapeDrawer.js"></script>
    <script src="src/utils/TriangleDrawer.js"></script>
    <script src="src/utils/ParallelogramDrawer.js"></script>
    <script src="src/utils/generators/AreasGenerator.js"></script>
    <script src="src/trainers/BaseTrainer.js"></script>
    <script src="src/trainers/AreasTrainer.js"></script>

    <script>
        function testGenerator() {
            const output = document.getElementById('output');
            try {
                const generator = new AreasGenerator();
                const settings = {
                    parallelogram: true,
                    rhombus: true,
                    rectangle: true,
                    square: true,
                    triangle: true,
                    trapezoid: true,
                    circle: true
                };

                const problem = generator.generate(settings);
                output.textContent = 'Генератор работает!\n\n' + JSON.stringify(problem, null, 2);
                console.log('Generated problem:', problem);
            } catch (error) {
                output.textContent = 'Ошибка генератора:\n' + error.message + '\n\n' + error.stack;
                console.error('Generator error:', error);
            }
        }

        function testDrawing() {
            const visualization = document.getElementById('visualization');
            const output = document.getElementById('output');

            try {
                const generator = new AreasGenerator();
                const settings = {
                    square: true,
                    parallelogram: false,
                    rhombus: false,
                    rectangle: false,
                    triangle: false,
                    trapezoid: false,
                    circle: false
                };

                const problem = generator.generate(settings);
                output.textContent = 'Задача:\n' + JSON.stringify(problem, null, 2);

                // Создаём SVG
                visualization.innerHTML = '';
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '650');
                svg.setAttribute('height', '500');
                svg.setAttribute('viewBox', '0 0 650 500');

                // Рисуем фигуру
                const drawer = new ParallelogramDrawer();
                const shape = drawer.drawSquare({
                    baseX: 200,
                    baseY: 350,
                    side: problem.side,
                    labels: problem.labels
                });

                svg.appendChild(shape);
                visualization.appendChild(svg);

                output.textContent += '\n\nОтрисовка успешна!';
            } catch (error) {
                output.textContent = 'Ошибка отрисовки:\n' + error.message + '\n\n' + error.stack;
                console.error('Drawing error:', error);
            }
        }

        function testTrainer() {
            const output = document.getElementById('output');
            const visualization = document.getElementById('visualization');

            try {
                // Создаём минимальный DOM для тренажёра
                const testHTML = `
                    <div id="areas-screen" class="screen">
                        <div id="areas-problem-display"></div>
                        <h3 id="areas-question-text"></h3>
                        <div id="areas-shape-container"></div>
                        <input type="number" id="areas-answer-input">
                        <button id="areas-check-btn">Проверить</button>
                        <button id="areas-back-btn">Назад</button>
                        <button id="areas-settings-btn">Настройки</button>
                        <div id="areas-result-message"></div>
                        <span id="areas-level-text"></span>
                        <span id="areas-progress-text"></span>
                        <div id="areas-progress-fill"></div>
                    </div>
                    <div id="areas-settings" class="screen">
                        <button id="areas-settings-back-btn">Назад</button>
                        <input type="checkbox" id="areas-parallelogram" checked>
                        <input type="checkbox" id="areas-rhombus" checked>
                        <input type="checkbox" id="areas-rectangle" checked>
                        <input type="checkbox" id="areas-square" checked>
                        <input type="checkbox" id="areas-triangle" checked>
                        <input type="checkbox" id="areas-trapezoid" checked>
                        <input type="checkbox" id="areas-circle" checked>
                    </div>
                `;

                if (!document.getElementById('areas-screen')) {
                    document.body.insertAdjacentHTML('beforeend', testHTML);
                }

                const trainer = new AreasTrainer();
                trainer.initDOM();

                output.textContent = 'Тренажёр инициализирован!\nПроверьте контейнер ниже...';

                // Генерируем задачу
                trainer.generateNewProblem();

                // Копируем содержимое в визуализацию
                const container = document.getElementById('areas-shape-container');
                visualization.innerHTML = container.innerHTML;

                output.textContent += '\n\nТекущая задача: ' + trainer.currentProblem?.shapeName;
                output.textContent += '\nПлощадь: ' + trainer.currentProblem?.area;

            } catch (error) {
                output.textContent = 'Ошибка тренажёра:\n' + error.message + '\n\n' + error.stack;
                console.error('Trainer error:', error);
            }
        }
    </script>
</body>
</html>
