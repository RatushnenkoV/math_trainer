<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест тренажёра площадей</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            margin-top: 0;
            color: #333;
        }
        svg {
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        .info {
            margin-top: 10px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 4px;
        }
        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Тест генератора площадей</h1>

    <div class="test-container">
        <h2>Генератор задач</h2>
        <button onclick="generateProblem('triangle')">Треугольник</button>
        <button onclick="generateProblem('parallelogram')">Параллелограмм</button>
        <button onclick="generateProblem('rectangle')">Прямоугольник</button>
        <button onclick="generateProblem('square')">Квадрат</button>
        <button onclick="generateProblem('rhombus')">Ромб</button>
        <button onclick="generateProblem('trapezoid')">Трапеция</button>
        <button onclick="generateProblem('circle')">Круг</button>
        <button onclick="generateWithTrig()">С тригонометрией</button>
        <button onclick="generateWithDiagonals()">С диагоналями</button>
    </div>

    <div class="test-container">
        <div id="problem-display"></div>
        <div class="info" id="problem-info"></div>
    </div>

    <script src="src/utils/TriangleDrawer.js"></script>
    <script src="src/utils/ParallelogramDrawer.js"></script>
    <script src="src/utils/ShapeDrawer.js"></script>
    <script src="src/trainers/AreasGenerator.js"></script>
    <script>
        const triangleDrawer = new TriangleDrawer();
        const parallelogramDrawer = new ParallelogramDrawer();
        const shapeDrawer = new ShapeDrawer();

        const defaultSettings = {
            triangle: false,
            rightTriangle: false,
            parallelogram: false,
            rectangle: false,
            rhombus: false,
            square: false,
            trapezoid: false,
            circle: false,
            useDiagonals: false,
            useTrig: false
        };

        function generateProblem(shapeType) {
            const settings = { ...defaultSettings };
            settings[shapeType] = true;

            const generator = new AreasGenerator(settings);
            const problem = generator.generateProblem();

            displayProblem(problem);
        }

        function generateWithTrig() {
            const settings = { ...defaultSettings, triangle: true, parallelogram: true, rhombus: true, useTrig: true };
            const generator = new AreasGenerator(settings);
            const problem = generator.generateProblem();

            displayProblem(problem);
        }

        function generateWithDiagonals() {
            const settings = { ...defaultSettings, parallelogram: true, rhombus: true, square: true, useDiagonals: true };
            const generator = new AreasGenerator(settings);
            const problem = generator.generateProblem();

            displayProblem(problem);
        }

        function formatLabel(value, hasSqrt2, hasSqrt3, variable) {
            if (hasSqrt2) {
                return variable + ' = ' + value + '\\\\sqrt{2}';
            } else if (hasSqrt3) {
                return variable + ' = ' + value + '\\\\sqrt{3}';
            } else {
                return variable + ' = ' + value;
            }
        }

        function displayProblem(problem) {
            if (!problem) {
                document.getElementById('problem-display').innerHTML = '<p>Не удалось сгенерировать задачу</p>';
                return;
            }

            const { type, params, scale = 10, area, isPi } = problem;

            // Создаём SVG контейнер
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '650');
            svg.setAttribute('height', '500');
            svg.setAttribute('viewBox', '0 0 650 500');
            svg.style.cssText = 'max-width:100%;height:auto';

            let shape = null;

            // Рисуем фигуру
            switch (type) {
                case 'triangle_h':
                    shape = triangleDrawer.drawByBaseAndHeight({
                        baseX: 150,
                        baseY: 350,
                        base: params.a * scale,
                        height: params.h * scale,
                        heightPosition: (params.a * scale) / 3,
                        labels: {
                            a: `a = ${params.a}`,
                            h: `h = ${params.h}`
                        }
                    });
                    break;

                case 'triangle_trig':
                    shape = triangleDrawer.drawBySidesAndAngle({
                        baseX: 150,
                        baseY: 350,
                        sideA: params.a * scale,
                        sideB: params.b * scale,
                        angle: params.angle,
                        labels: {
                            a: formatLabel(params.a, params.aHasSqrt2, params.aHasSqrt3, 'a'),
                            b: formatLabel(params.b, params.bHasSqrt2, params.bHasSqrt3, 'b'),
                            showAngle: true
                        }
                    });
                    break;

                case 'right_triangle':
                    shape = triangleDrawer.drawRightTriangle({
                        baseX: 150,
                        baseY: 350,
                        cathetus1: params.a * scale,
                        cathetus2: params.b * scale,
                        labels: {
                            a: `a = ${params.a}`,
                            b: `b = ${params.b}`
                        }
                    });
                    break;

                case 'parallelogram_h':
                    shape = parallelogramDrawer.drawBySideAndHeight({
                        baseX: 150,
                        baseY: 350,
                        sideA: params.a * scale,
                        height: params.h * scale,
                        offset: 3 * scale,
                        labels: {
                            a: `a = ${params.a}`,
                            h: `h = ${params.h}`
                        }
                    });
                    break;

                case 'parallelogram_trig':
                    shape = parallelogramDrawer.drawBySidesAndAngle({
                        baseX: 150,
                        baseY: 350,
                        sideA: params.a * scale,
                        sideB: params.b * scale,
                        angle: params.angle,
                        labels: {
                            a: formatLabel(params.a, params.aHasSqrt2, params.aHasSqrt3, 'a'),
                            b: formatLabel(params.b, params.bHasSqrt2, params.bHasSqrt3, 'b'),
                            showAngle: true
                        }
                    });
                    break;

                case 'parallelogram_diag':
                    shape = shapeDrawer.drawParallelogramByDiagonals({
                        centerX: 300,
                        centerY: 250,
                        diagonal1: params.d1 * scale,
                        diagonal2: params.d2 * scale,
                        angle: params.angle,
                        labels: {
                            d1: formatLabel(params.d1, params.d1HasSqrt2, params.d1HasSqrt3, 'd_1'),
                            d2: formatLabel(params.d2, params.d2HasSqrt2, params.d2HasSqrt3, 'd_2'),
                            showAngle: true
                        }
                    });
                    break;

                case 'rectangle':
                    shape = parallelogramDrawer.drawRectangle({
                        baseX: 150,
                        baseY: 350,
                        width: params.a * scale,
                        height: params.b * scale,
                        labels: {
                            a: `a = ${params.a}`,
                            b: `b = ${params.b}`
                        }
                    });
                    break;

                case 'square':
                    shape = parallelogramDrawer.drawSquare({
                        baseX: 150,
                        baseY: 350,
                        side: params.a * scale,
                        labels: {
                            a: `a = ${params.a}`
                        }
                    });
                    break;

                case 'square_diag':
                    shape = shapeDrawer.drawRhombusByDiagonals({
                        centerX: 300,
                        centerY: 250,
                        diagonal1: params.d * scale,
                        diagonal2: params.d * scale,
                        labels: {
                            d1: `d = ${params.d}`
                        }
                    });
                    break;

                case 'rhombus_h':
                    shape = parallelogramDrawer.drawRhombusBySideAndHeight({
                        baseX: 150,
                        baseY: 350,
                        side: params.a * scale,
                        height: params.h * scale,
                        labels: {
                            a: `a = ${params.a}`,
                            h: `h = ${params.h}`
                        }
                    });
                    break;

                case 'rhombus_trig':
                    shape = parallelogramDrawer.drawRhombusBySideAndAngle({
                        baseX: 150,
                        baseY: 350,
                        side: params.a * scale,
                        angle: params.angle,
                        labels: {
                            a: formatLabel(params.a, params.aHasSqrt2, params.aHasSqrt3, 'a'),
                            showAngle: true
                        }
                    });
                    break;

                case 'rhombus_diag':
                    shape = shapeDrawer.drawRhombusByDiagonals({
                        centerX: 300,
                        centerY: 250,
                        diagonal1: params.d1 * scale,
                        diagonal2: params.d2 * scale,
                        labels: {
                            d1: `d_1 = ${params.d1}`,
                            d2: `d_2 = ${params.d2}`
                        }
                    });
                    break;

                case 'trapezoid':
                    shape = shapeDrawer.drawTrapezoid({
                        baseX: 150,
                        baseY: 350,
                        base1: params.a * scale,
                        base2: params.b * scale,
                        height: params.h * scale,
                        labels: {
                            a: `a = ${params.a}`,
                            b: `b = ${params.b}`,
                            h: `h = ${params.h}`
                        }
                    });
                    break;

                case 'trapezoid_midline':
                    shape = shapeDrawer.drawTrapezoidByMidline({
                        baseX: 150,
                        baseY: 350,
                        midline: params.m * scale,
                        height: params.h * scale,
                        labels: {
                            m: `m = ${params.m}`,
                            h: `h = ${params.h}`
                        }
                    });
                    break;

                case 'rectangle_diag':
                    shape = shapeDrawer.drawRectangleByDiagonal({
                        centerX: 300,
                        centerY: 250,
                        diagonal: params.d * scale,
                        angle: params.angle,
                        labels: {
                            d: formatLabel(params.d, params.dHasSqrt2, params.dHasSqrt3, 'd'),
                            showAngle: true
                        }
                    });
                    break;

                case 'circle':
                    shape = shapeDrawer.drawCircle({
                        centerX: 300,
                        centerY: 250,
                        radius: params.r * scale,
                        labels: {
                            r: `R = ${params.r}`
                        }
                    });
                    break;
            }

            if (shape) {
                svg.appendChild(shape);
            }

            document.getElementById('problem-display').innerHTML = '';
            document.getElementById('problem-display').appendChild(svg);

            // Показываем информацию о задаче
            const info = `
                <p><strong>Тип:</strong> ${type}</p>
                <p><strong>Площадь:</strong> ${area}${isPi ? 'π' : ''}</p>
                <p><strong>Параметры:</strong> ${JSON.stringify(params)}</p>
            `;
            document.getElementById('problem-info').innerHTML = info;
        }
    </script>
</body>
</html>
